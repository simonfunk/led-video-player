<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Video Player - Control Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .status-item label {
            display: block;
            color: #666;
            font-size: 0.85em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-item value {
            display: block;
            color: #333;
            font-size: 1.2em;
            font-weight: bold;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: move;
        }

        .image-item:hover {
            transform: scale(1.05);
        }

        .image-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .image-item.drag-over {
            border: 3px solid #667eea;
        }

        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .image-item .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 5px 10px;
            background: rgba(245, 101, 101, 0.9);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            min-width: auto;
        }

        .image-item .filename {
            padding: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 0.75em;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #e2e8f0;
            border: none;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s;
            min-width: auto;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .message {
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }

        .message.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .message.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ LED Video Player</h1>

        <!-- Status Card -->
        <div class="card">
            <h2>üìä Status</h2>
            <div class="status-grid">
                <div class="status-item">
                    <label>Mode</label>
                    <value id="status-mode">-</value>
                </div>
                <div class="status-item">
                    <label>Status</label>
                    <value id="status-playing">-</value>
                </div>
                <div class="status-item">
                    <label>Current Image</label>
                    <value id="status-current">-</value>
                </div>
                <div class="status-item">
                    <label>Day Images</label>
                    <value id="status-day-count">-</value>
                </div>
                <div class="status-item">
                    <label>Night Images</label>
                    <value id="status-night-count">-</value>
                </div>
                <div class="status-item">
                    <label>Interval</label>
                    <value id="status-interval">-</value>
                </div>
            </div>

            <div class="control-buttons">
                <button class="btn-primary" onclick="togglePause()">‚èØÔ∏è Play/Pause</button>
                <button class="btn-primary" onclick="previousImage()">‚èÆÔ∏è Previous</button>
                <button class="btn-primary" onclick="nextImage()">‚è≠Ô∏è Next</button>
                <button class="btn-success" onclick="switchMode('day')">‚òÄÔ∏è Day Mode</button>
                <button class="btn-warning" onclick="switchMode('night')">üåô Night Mode</button>
            </div>
        </div>

        <!-- Settings Card -->
        <div class="card">
            <h2>‚öôÔ∏è Settings</h2>
            <div id="settings-message" class="message"></div>

            <div class="form-group">
                <label>Interval (seconds)</label>
                <input type="number" id="interval" min="1" value="60">
            </div>

            <div class="form-group">
                <label>Shuffle</label>
                <select id="shuffle">
                    <option value="true">Enabled</option>
                    <option value="false">Disabled</option>
                </select>
            </div>

            <div class="form-group">
                <label>Day Folder</label>
                <input type="text" id="day-folder" placeholder="./images/day">
            </div>

            <div class="form-group">
                <label>Night Folder</label>
                <input type="text" id="night-folder" placeholder="./images/night">
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px;">üìÖ Schedule</h3>

            <div class="form-group">
                <label>Schedule Mode</label>
                <select id="schedule-mode">
                    <option value="fixed">Fixed Times</option>
                    <option value="sun">Sunrise/Sunset</option>
                </select>
            </div>

            <div id="fixed-schedule-section">
                <div class="form-group">
                    <label>‚òÄÔ∏è Day Start Time (24h format)</label>
                    <input type="time" id="day-start" value="06:00">
                </div>

                <div class="form-group">
                    <label>üåô Night Start Time (24h format)</label>
                    <input type="time" id="night-start" value="18:00">
                </div>
            </div>

            <div id="sun-schedule-section" style="display: none;">
                <div class="form-group">
                    <label>Latitude</label>
                    <input type="number" id="latitude" step="0.0001" placeholder="47.3769">
                </div>

                <div class="form-group">
                    <label>Longitude</label>
                    <input type="number" id="longitude" step="0.0001" placeholder="8.5417">
                </div>
            </div>

            <button class="btn-success" onclick="saveSettings()">üíæ Save Settings</button>
        </div>

        <!-- Images Card -->
        <div class="card">
            <h2>üñºÔ∏è Images</h2>
            <div id="images-message" class="message"></div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('day')">‚òÄÔ∏è Day Images</button>
                <button class="tab" onclick="switchTab('night')">üåô Night Images</button>
                <button class="tab" onclick="switchTab('day-playlist')">üìã Day Playlist</button>
                <button class="tab" onclick="switchTab('night-playlist')">üìã Night Playlist</button>
            </div>

            <div id="day-tab" class="tab-content active">
                <div class="upload-area" onclick="document.getElementById('day-upload').click()">
                    <p>üìÅ Click to upload images to Day folder</p>
                    <input type="file" id="day-upload" accept="image/*" multiple onchange="uploadImages('day')">
                </div>
                <div id="day-images" class="image-grid"></div>
            </div>

            <div id="night-tab" class="tab-content">
                <div class="upload-area" onclick="document.getElementById('night-upload').click()">
                    <p>üìÅ Click to upload images to Night folder</p>
                    <input type="file" id="night-upload" accept="image/*" multiple onchange="uploadImages('night')">
                </div>
                <div id="night-images" class="image-grid"></div>
            </div>

            <div id="day-playlist-tab" class="tab-content">
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div style="flex: 1;">
                        <h3 style="margin-bottom: 10px;">Available Images</h3>
                        <div id="day-available" class="image-grid" style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; padding: 10px; border-radius: 8px;"></div>
                    </div>
                    <div style="flex: 1;">
                        <h3 style="margin-bottom: 10px;">Playlist <button class="btn-success" style="float: right; padding: 5px 15px; min-width: auto;" onclick="savePlaylist('day')">üíæ Save</button></h3>
                        <div id="day-playlist" class="image-grid" style="max-height: 400px; overflow-y: auto; border: 2px solid #667eea; padding: 10px; border-radius: 8px; background: #f7fafc;"></div>
                    </div>
                </div>
            </div>

            <div id="night-playlist-tab" class="tab-content">
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div style="flex: 1;">
                        <h3 style="margin-bottom: 10px;">Available Images</h3>
                        <div id="night-available" class="image-grid" style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; padding: 10px; border-radius: 8px;"></div>
                    </div>
                    <div style="flex: 1;">
                        <h3 style="margin-bottom: 10px;">Playlist <button class="btn-success" style="float: right; padding: 5px 15px; min-width: auto;" onclick="savePlaylist('night')">üíæ Save</button></h3>
                        <div id="night-playlist" class="image-grid" style="max-height: 400px; overflow-y: auto; border: 2px solid #667eea; padding: 10px; border-radius: 8px; background: #f7fafc;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'day';

        // Load initial data
        loadStatus();
        loadConfig();
        loadImages('day');
        loadImages('night');
        loadPlaylistView('day');
        loadPlaylistView('night');

        // Auto-refresh status every 2 seconds
        setInterval(loadStatus, 2000);

        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();

                document.getElementById('status-mode').textContent = data.mode.toUpperCase();
                document.getElementById('status-playing').textContent = data.is_paused ? 'Paused' : 'Playing';
                document.getElementById('status-current').textContent = data.current_image || 'None';
                document.getElementById('status-day-count').textContent = data.day_images_count;
                document.getElementById('status-night-count').textContent = data.night_images_count;
                document.getElementById('status-interval').textContent = data.interval + 's';
            } catch (error) {
                console.error('Error loading status:', error);
            }
        }

        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const data = await response.json();

                document.getElementById('interval').value = data.playback.interval_seconds;
                document.getElementById('shuffle').value = data.playback.shuffle.toString();
                document.getElementById('day-folder').value = data.folders.day;
                document.getElementById('night-folder').value = data.folders.night;

                // Load schedule settings
                if (data.schedule) {
                    document.getElementById('schedule-mode').value = data.schedule.mode;

                    if (data.schedule.fixed_schedule) {
                        document.getElementById('day-start').value = data.schedule.fixed_schedule.day_start;
                        document.getElementById('night-start').value = data.schedule.fixed_schedule.night_start;
                    }

                    if (data.schedule.sun_schedule) {
                        document.getElementById('latitude').value = data.schedule.sun_schedule.latitude;
                        document.getElementById('longitude').value = data.schedule.sun_schedule.longitude;
                    }

                    updateScheduleVisibility();
                }
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }

        function updateScheduleVisibility() {
            const mode = document.getElementById('schedule-mode').value;
            const fixedSection = document.getElementById('fixed-schedule-section');
            const sunSection = document.getElementById('sun-schedule-section');

            if (mode === 'fixed') {
                fixedSection.style.display = 'block';
                sunSection.style.display = 'none';
            } else {
                fixedSection.style.display = 'none';
                sunSection.style.display = 'block';
            }
        }

        // Add event listener for schedule mode change
        document.addEventListener('DOMContentLoaded', () => {
            const scheduleModeSelect = document.getElementById('schedule-mode');
            if (scheduleModeSelect) {
                scheduleModeSelect.addEventListener('change', updateScheduleVisibility);
            }
        });

        async function saveSettings() {
            try {
                const scheduleMode = document.getElementById('schedule-mode').value;

                const data = {
                    playback: {
                        interval_seconds: parseInt(document.getElementById('interval').value),
                        shuffle: document.getElementById('shuffle').value === 'true'
                    },
                    folders: {
                        day: document.getElementById('day-folder').value,
                        night: document.getElementById('night-folder').value
                    },
                    schedule: {
                        mode: scheduleMode,
                        fixed_schedule: {
                            day_start: document.getElementById('day-start').value,
                            night_start: document.getElementById('night-start').value
                        },
                        sun_schedule: {
                            latitude: parseFloat(document.getElementById('latitude').value) || 40.7128,
                            longitude: parseFloat(document.getElementById('longitude').value) || -74.0060
                        }
                    }
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showMessage('settings-message', result.message || 'Settings saved!', 'success');
            } catch (error) {
                showMessage('settings-message', 'Error saving settings: ' + error.message, 'error');
            }
        }

        async function togglePause() {
            try {
                await fetch('/api/control/pause', { method: 'POST' });
                loadStatus();
            } catch (error) {
                console.error('Error toggling pause:', error);
            }
        }

        async function nextImage() {
            try {
                await fetch('/api/control/next', { method: 'POST' });
                loadStatus();
            } catch (error) {
                console.error('Error skipping to next:', error);
            }
        }

        async function previousImage() {
            try {
                await fetch('/api/control/previous', { method: 'POST' });
                loadStatus();
            } catch (error) {
                console.error('Error going to previous:', error);
            }
        }

        async function switchMode(mode) {
            try {
                await fetch('/api/control/mode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode })
                });
                loadStatus();
            } catch (error) {
                console.error('Error switching mode:', error);
            }
        }

        async function loadImages(mode) {
            try {
                const response = await fetch(`/api/images/${mode}`);
                const data = await response.json();

                const container = document.getElementById(`${mode}-images`);
                container.innerHTML = '';

                data.images.forEach((filename, index) => {
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.draggable = true;
                    item.dataset.filename = filename;
                    item.dataset.mode = mode;
                    item.dataset.index = index;

                    item.innerHTML = `
                        <img src="/api/images/${mode}/${filename}" alt="${filename}">
                        <div class="filename">${filename}</div>
                        <button class="delete-btn" onclick="deleteImage('${mode}', '${filename}')">‚úï</button>
                    `;

                    // Add drag event listeners
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragenter', handleDragEnter);
                    item.addEventListener('dragleave', handleDragLeave);

                    container.appendChild(item);
                });
            } catch (error) {
                console.error('Error loading images:', error);
            }
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');

            // Remove all drag-over classes
            document.querySelectorAll('.image-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            if (this !== draggedElement) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                // Get the mode
                const mode = this.dataset.mode;

                // Get all items in this mode
                const container = document.getElementById(`${mode}-images`);
                const items = Array.from(container.querySelectorAll('.image-item'));

                // Get positions
                const draggedIndex = items.indexOf(draggedElement);
                const targetIndex = items.indexOf(this);

                // Reorder DOM
                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedElement, this);
                }

                // Save new order to backend
                saveImageOrder(mode);
            }

            return false;
        }

        async function saveImageOrder(mode) {
            try {
                const container = document.getElementById(`${mode}-images`);
                const items = Array.from(container.querySelectorAll('.image-item'));
                const order = items.map(item => item.dataset.filename);

                const response = await fetch(`/api/images/${mode}/order`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ order })
                });

                if (response.ok) {
                    showMessage('images-message', 'Image order saved!', 'success');
                } else {
                    showMessage('images-message', 'Failed to save order', 'error');
                }
            } catch (error) {
                console.error('Error saving image order:', error);
                showMessage('images-message', 'Error saving order: ' + error.message, 'error');
            }
        }

        async function uploadImages(mode) {
            const input = document.getElementById(`${mode}-upload`);
            const files = input.files;

            if (files.length === 0) return;

            for (let file of files) {
                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch(`/api/images/${mode}/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        showMessage('images-message', `Uploaded ${file.name}`, 'success');
                    }
                } catch (error) {
                    showMessage('images-message', `Error uploading ${file.name}`, 'error');
                }
            }

            // Clear input and reload images
            input.value = '';
            loadImages(mode);
            loadStatus();
        }

        async function deleteImage(mode, filename) {
            if (!confirm(`Delete ${filename}?`)) return;

            try {
                const response = await fetch(`/api/images/${mode}/${filename}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('images-message', `Deleted ${filename}`, 'success');
                    loadImages(mode);
                    loadStatus();
                }
            } catch (error) {
                showMessage('images-message', `Error deleting ${filename}`, 'error');
            }
        }

        function switchTab(tab) {
            currentTab = tab;

            // Update tabs
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message ${type}`;
            element.style.display = 'block';

            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        // Playlist functionality
        async function loadPlaylistView(mode) {
            try {
                // Load available images
                const response = await fetch(`/api/images/${mode}`);
                const data = await response.json();

                const availableContainer = document.getElementById(`${mode}-available`);
                availableContainer.innerHTML = '';

                data.images.forEach(filename => {
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.style.cursor = 'pointer';
                    item.dataset.filename = filename;
                    item.dataset.mode = mode;

                    item.innerHTML = `
                        <img src="/api/images/${mode}/${filename}" alt="${filename}">
                        <div class="filename">${filename}</div>
                    `;

                    item.onclick = () => addToPlaylist(mode, filename);
                    availableContainer.appendChild(item);
                });

                // Load existing playlist
                const playlistResponse = await fetch(`/api/playlist/${mode}`);
                if (playlistResponse.ok) {
                    const playlistData = await playlistResponse.json();
                    renderPlaylist(mode, playlistData.playlist || []);
                }
            } catch (error) {
                console.error('Error loading playlist view:', error);
            }
        }

        function addToPlaylist(mode, filename) {
            const playlistContainer = document.getElementById(`${mode}-playlist`);

            // Generate unique ID for this playlist item
            const itemId = `playlist-${mode}-${Date.now()}-${Math.random()}`;

            const item = document.createElement('div');
            item.className = 'image-item';
            item.draggable = true;
            item.dataset.filename = filename;
            item.dataset.mode = mode;
            item.dataset.itemId = itemId;

            item.innerHTML = `
                <img src="/api/images/${mode}/${filename}" alt="${filename}">
                <div class="filename">${filename}</div>
                <button class="delete-btn" onclick="removeFromPlaylist('${mode}', '${itemId}')">‚úï</button>
            `;

            // Add drag event listeners
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragend', handleDragEnd);
            item.addEventListener('dragover', handleDragOver);
            item.addEventListener('drop', handleDrop);
            item.addEventListener('dragenter', handleDragEnter);
            item.addEventListener('dragleave', handleDragLeave);

            playlistContainer.appendChild(item);
        }

        function removeFromPlaylist(mode, itemId) {
            const item = document.querySelector(`[data-item-id="${itemId}"]`);
            if (item) {
                item.remove();
            }
        }

        function renderPlaylist(mode, playlist) {
            const playlistContainer = document.getElementById(`${mode}-playlist`);
            playlistContainer.innerHTML = '';

            playlist.forEach(filename => {
                addToPlaylist(mode, filename);
            });
        }

        async function savePlaylist(mode) {
            try {
                const playlistContainer = document.getElementById(`${mode}-playlist`);
                const items = Array.from(playlistContainer.querySelectorAll('.image-item'));
                const playlist = items.map(item => item.dataset.filename);

                const response = await fetch(`/api/playlist/${mode}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ playlist })
                });

                if (response.ok) {
                    showMessage('images-message', `${mode.charAt(0).toUpperCase() + mode.slice(1)} playlist saved! (${playlist.length} items)`, 'success');
                } else {
                    showMessage('images-message', 'Failed to save playlist', 'error');
                }
            } catch (error) {
                console.error('Error saving playlist:', error);
                showMessage('images-message', 'Error saving playlist: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
